---
- hosts: all
  become: true

  roles:
    - andrewrothstein.java-oracle-jdk
  
  tasks:
    - include: tasks/setup_linux.yml
    - include: tasks/setup_restheart.yml
    - include: tasks/setup_nginx.yml
    - include: tasks/setup_cpauth.yml
    
  handlers:
  - name: reload nginx config
    service: name=nginx state=reloaded

  - name: reload systemd config
    command: systemctl daemon-reload

  - name: compile cpauth
    become_user: cpauth
    command: sbt assembly chdir=/home/cpauth/cpauth
    notify: restart cpauth

  - name: restart cpauth
    service: name=cpauth state=restarted
  
    
  
    
