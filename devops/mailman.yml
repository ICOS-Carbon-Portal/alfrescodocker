# Build mailman images
#   deploy mailman mailman_build
#
# Copy build files but do not build nor start containers.
#   deploy mailman mailman_build -edocker_do_build=False
#
# Redeploy backup scripts
#   deploy mailman bbclient

- hosts: fsicos2.lunarc.lu.se
  become: true
  vars:
    mailman_username: mailman
  vars_files:
    - vault.yml
  roles:
    - role: icos.mailman
      tags: mailman
      mailman_rest_allow_deny: "{{ vault_mailman_rest_allow_deny }}"
      mailman_domains:
        - 'lists.icos-ri.eu'
        - 'lists.eric-forum.eu'
        - 'lists.icos-cities.eu'

    - role: icos.bbclient2
      tags: bbclient
      vars:
        bbclient_name: mailman
        bbclient_user: root
        bbclient_home: "{{ mailman_home }}/bbclient"
        bbclient_coldbackup: "{{ mailman_home }}"
