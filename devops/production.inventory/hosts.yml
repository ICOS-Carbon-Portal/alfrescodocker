all:
  # GLOBAL VARS
  vars:
    ansible_user: root
    ansible_python_interpreter: /usr/bin/python3
    quince_ext_port: 60522
    bbclient_remotes:
      - fsicos2.lunarc.lu.se
      - cdb.nateko.lu.se

    fsicos1_ip: 194.47.223.133
    fsicos2_ip: 194.47.223.139
    fsicos3_ip: 194.47.223.137
    cdb_ip: 130.235.99.237

    node_exporter_allow_from: '{{ cdb_ip }}'
    prometheus_ansible_path: /docker/prometheus/volumes/prometheus_conf/ansible

  hosts:

  children:
    # PHYSICAL SERVERS
    physical_servers:
      vars:
        smartmon_enable: true
        dirsize_enable: true
      hosts:
        cdb.nateko.lu.se:
          lxd_vm_variant: ext4
          dockermon_enable: true
          pgrep_vm_name: 'pgrep-rdflog@cdb'
        fsicos2.lunarc.lu.se:
          lxd_vm_variant: ext4
          nextcloud_volume_nextcloud: /disk/data/nextcloud
          dockermon_enable: true
          dirsize_initial:
            - /disk/data/nextcloud
            - /var/log
          flexpart_install_run: true
          flexpart_max_parallel: 12
          flexpart_export_output_to: "194.47.223.133(ro,no_subtree_check)"

          cpmeta_filestorage_target: /disk/data/metaAppStorage
          cpdata_filestorage_target: /disk/data/dataAppStorage

          stilt_nfs_exports: |
                /disk/data/stiltweb   {{ fsicos1_ip }}(ro)
                /disk/data/stilt      {{ fsicos1_ip }}(ro)
          stiltcluster_port: 2561
          stiltcluster_front_port: 2550
          stiltcluster_maxcores: 20

          bbclient_remotes:
            - fsicos2.lunarc.lu.se
            - cdb.nateko.lu.se

          icosdata_exports: |
            /disk/data/nextcloud/data/__groupfolders/14/Data/FLUXCOM fsicos*.lunarc.lu.se(ro,no_root_squash)
            # CoCO2
            /disk/data/nextcloud/data/__groupfolders/32 fsicos3.lunarc.lu.se(ro,no_root_squash)
            /disk/data/flexextract            fsicos*.lunarc.lu.se(rw)
            /disk/data/project                fsicos*.lunarc.lu.se(ro)
            /disk/data/flexpart/meteo         fsicos*.lunarc.lu.se(ro)
            /disk/data/dataAppStorage         fsicos*.lunarc.lu.se(ro)
            /disk/data/stiltweb               fsicos*.lunarc.lu.se(ro)
            /disk/data/obspack                fsicos*.lunarc.lu.se(ro)
            /disk/data/stilt                  fsicos*.lunarc.lu.se(ro)
            /disk/data/common/netcdf/dataDemo fsicos*.lunarc.lu.se(rw)

          icosdata_mkdirs:
            - /data/stilt
            - /share/fsicos3
            - /share/with_nextcloud/jupyter_coco2

          icosdata_bind_mounts:
            - path: /data/stiltweb
              src: /disk/data/stiltweb
              opts: ",ro"

            - path: /data/project
              src: /disk/data/project

            - path: /data/dataAppStorage
              src: /disk/data/dataAppStorage
              opts: ",ro"

            - path: /data/stilt_legacy
              src: /disk/data/stilt
              opts: ",ro"

          icosdata_nfs_mounts:
            - path: /share/with_nextcloud/jupyter_coco2
              src: fsicos3.lunarc.lu.se:/pool/jupyter/project/coco2/jupyter
              opts: "ro,soft"

            - path: /share/fsicos3
              src: fsicos3.lunarc.lu.se:/incoming
              opts: rw

            - path: /data/project/eurocom
              src: fsicos3.lunarc.lu.se:/data/project/eurocom
              opts: "ro,soft"

            - path: /data/stilt
              src: fsicos3.lunarc.lu.se:/pool/ute/stilt/RINGO/T1.3/STILT
              opts: "ro,soft"

            - path: /data/project/stc
              src: fsicos3.lunarc.lu.se:/data/project/stc
              opts: "ro,soft"

            - path: /data/flexpart/output
              src: fsicos3.lunarc.lu.se:/data/flexpart/output
              opts: "ro,soft"

        fsicos3.lunarc.lu.se:
          lxd_vm_variant: zfs
          pgrep_vm_name: 'pgrep-rdflog@fsicos3'
          icosdata_mkdirs:
            - /nfs

          icosdata_exports: |
            # The 'no_subtree_check' is to avoid warnings about the default behaviour having changed.
            /incoming                           fsicos2.lunarc.lu.se(rw,no_root_squash,no_subtree_check)
            /data/project/stc                   fsicos2.lunarc.lu.se(ro,no_subtree_check)
            /data/project/interpolation         fsicos2.lunarc.lu.se(ro,no_subtree_check)
            /data/project/eurocom               fsicos2.lunarc.lu.se(ro,no_subtree_check)
            /pool/ute/stilt/RINGO/T1.3/STILT    fsicos2.lunarc.lu.se(ro,no_subtree_check)
            /data/flexpart/output               fsicos2.lunarc.lu.se(rw,no_subtree_check)
            /pool/jupyter/project/coco2/jupyter fsicos2.lunarc.lu.se(ro,no_subtree_check,no_root_squash)

          icosdata_nfs_mounts:
            - path: /pool/jupyter/project/coco2/fileshare
              src: fsicos2.lunarc.lu.se:/disk/data/nextcloud/data/__groupfolders/32
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /nfs/fluxcom_eo
              src: fsicos2.lunarc.lu.se:/disk/data/nextcloud/data/__groupfolders/14/Data/FLUXCOM
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            # flexextract - read-write
            - path: /nfs/flexextract
              src: fsicos2.lunarc.lu.se:/disk/data/flexextract
              opts: "rw,x-systemd.after=zfs-mount.service"

            # flexextract - read-only
            - path: /data/flexextract
              src: fsicos2.lunarc.lu.se:/disk/data/flexextract
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/flexpart/meteo
              src: fsicos2.lunarc.lu.se:/disk/data/flexpart/meteo
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/dataAppStorage
              src: fsicos2.lunarc.lu.se:/disk/data/dataAppStorage
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/stiltweb
              src: fsicos2.lunarc.lu.se:/disk/data/stiltweb
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/obspack
              src: fsicos2.lunarc.lu.se:/disk/data/obspack
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/stilt_legacy
              src: fsicos2.lunarc.lu.se:/disk/data/stilt
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /data/project/climbeco
              src: fsicos2.lunarc.lu.se:/disk/data/project/climbeco
              opts: "ro,soft,x-systemd.after=zfs-mount.service"

            - path: /pool/ute/dataDemo
              src: fsicos2.lunarc.lu.se:/disk/data/common/netcdf/dataDemo
              opts: "rw,x-systemd.after=zfs-mount.service"




    # CDB VMS
    cdb_vms:
      vars:
        ansible_host: cdb.nateko.lu.se
      hosts:
        pgrep-rdflog@cdb:
          ansible_port: 60550
          pgrep_arg:
            suffix: rdflog
            peer_user: pgrepuser
            peer_host: fsicos2.lunarc.lu.se
            peer_port: 60002
            peer_slot: cdb
            peer_pass: "{{ vault_rdflog_rep_pass }}"
            peer_cert: roles/icos.rdflog/files/server.crt
        prometheus:
          ansible_port: 60545

    # FSICOS2 VMS
    fsicos2_vms:
      vars:
          ansible_host: fsicos2.lunarc.lu.se
      hosts:
        eddyetc:
          ansible_port: 60523
        erddap:
          ansible_port: 60580
        flexextract:
          ansible_port: 60526
        postgis:
          ansible_port: 60590
        quince:
          quince_ext_port: 60522
          ansible_port: '{{ quince_ext_port }}'
        rspamd:
          ansible_port: 60585
        wordpress:
          ansible_port: 60552
        restore:
          ansible_port: 60505

    # FSICOS3 VMS
    fsicos3_vms:
      vars:
        ansible_host: fsicos3.lunarc.lu.se
      hosts:
        amalthea:
          ansible_port: 60560
        callisto:
          ansible_port: 60510
          docker_prevent_upgrade: True
        exploredata:
          ansible_port: 60555
          docker_prevent_upgrade: True
        flexpart:
          ansible_port: 60530
          docker_prevent_upgrade: True
        ganymede:
          ansible_port: 60540
          docker_prevent_upgrade: True
        jupyter:
          ansible_port: 60535
          docker_prevent_upgrade: True
          bbclient_name: jupyter
        molefractions:
          ansible_port: 60515
        nats3:
          ansible_port: 60550
        registry:
          ansible_port: 60545
        pgrep-rdflog@fsicos3:
          ansible_port: 60570
          pgrep_arg:
            suffix: rdflog
            peer_user: pgrepuser
            peer_host: fsicos2.lunarc.lu.se
            peer_port: 60002
            peer_slot: fsicos3
            peer_pass: "{{ vault_rdflog_rep_pass }}"
            peer_cert: roles/icos.rdflog/files/server.crt

    # OTHER GROUPS
    bbservers:
      hosts:
        cdb.nateko.lu.se:
          bbserver_home: /disk/data/bbserver
        fsicos2.lunarc.lu.se:
          bbserver_home: /disk/data/bbserver
    node_exporters:
      hosts:
        fsicos2.lunarc.lu.se:
        fsicos3.lunarc.lu.se:
