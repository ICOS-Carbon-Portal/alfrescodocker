- hosts: fsicos2.lunarc.lu.se
  vars:
    quince_host: quince3.lxd
    certbot_name: quince-testing
    quince_domains:
      - quince.icos-cp.eu

  roles:
    - name: Create the quince3 VM
      role: icos.lxd_vm
      lxd_vm_name: quince3
      lxd_vm_root_size: "200GB"
      lxd_vm_config:
        limits.cpu: "20"
        limits.memory: "64GB"

    # - role: icos.certbot2
    #   tags: certbot
    #   certbot_domains: "{{ quince_domains }}"

    # - role: icos.nginxsite
    #   tags: nginx
    #   nginxsite_name: quince-testing
    #   nginxsite_file: files/quince.conf
    #   quince_host: quince3.lxd

    # Regular quince.
    - role: icos.certbot2
      tags: cert
      certbot_name: quince
      certbot_domains:
        - quince.bcdc.no

    - role: icos.nginxsite
      tags: nginx
      nginxsite_name: quince
      nginxsite_file: files/quince.conf
      quince_cert: quince
      quince_domains:
        - quince.bcdc.no

    # Quince Intercomparison.
    - role: icos.certbot2
      tags: cert-ic
      certbot_name: quince-ic
      certbot_domains:
        - quince-ic1.bcdc.no
        - quince-ic2.bcdc.no
        - icoslabelling.bcdc.no

    - role: icos.nginxsite
      tags: nginx-ic
      nginxsite_name: quince-ic
      nginxsite_file: files/quince-ic.conf
      certbot_name: quince-ic
      quince_port: 8180
      quince_domains:
        - quince-ic1.bcdc.no
        - quince-ic2.bcdc.no
        - icoslabelling.bcdc.no

- hosts: quince3
  roles:
    - role: icos.lxd_guest

    - role: icos.quince
      quince_backup_enable: false
