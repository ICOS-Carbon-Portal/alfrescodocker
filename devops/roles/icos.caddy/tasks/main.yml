# First install standard version of caddy, this will create the caddy user and
# setup systemd service files.
- import_tasks: install.yml

- import_tasks: just.yml
  tags: caddy_just

# If we're not using any extra modules, then we're mostly done.
- import_tasks: plain.yml
  when: not caddy_modules

# If any modules are needed we need xcaddy instead.
- import_tasks: xcaddy.yml
  tags: caddy_xcaddy
  when: caddy_modules

- name: Check that caddy was properly installed
  ansible.builtin.shell: "{{ caddy_bin }} version"
  changed_when: no

- import_tasks: global.yml
  when: caddy_global_conf

- import_tasks: site.yml
  when: caddy_name is defined
  tags: caddy_site
