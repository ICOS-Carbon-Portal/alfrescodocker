- import_role: name=icos.certbot2
  tags: cpmeta_certbot

- import_tasks: deploy.yml

- name: Copy SSL certs and private key for Handle.net client
  tags: cpmeta_other
  copy:
    src: ssl
    dest: "{{ cpmeta_home }}/"
    owner: "{{ cpmeta_username }}"
    group: "{{ cpmeta_username }}"

- name: Create metaAppStorage directory (if not present), take ownership
  tags: cpmeta_other
  file:
    path: "{{ cpmeta_filestorage_target }}"
    state: directory
    owner: "{{ cpmeta_username }}"
    group: "{{ cpmeta_username }}"

- name: Copy backup.sh
  tags: cpmeta_backup
  template:
    src: backup.sh
    dest: "{{ cpmeta_backup_script }}"
    mode: +x

- name: Add backup to crontab
  tags: cpmeta_backup
  cron:
    job: "{{ cpmeta_backup_script }}"
    hour: "*"
    minute: "0"
    state: present
    name: "cpmeta_backup"
