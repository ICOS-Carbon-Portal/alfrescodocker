- name: Run the jarservice role
  tags: cpmeta
  include_role:
    name: icos.jarservice
  vars:
    username        : "{{ cpmeta_username }}"
    jarfile         : "{{ cpmeta_jar_file }}"
    appconfig       : "{{ cpmeta_appconfig }}"
    nginxconfig     : "{{ cpmeta_nginxconfig }}"
    servicename     : "{{ cpmeta_servicename }}"
    servicetemplate : "{{ cpmeta_template }}"

# https://github.com/ansible/ansible/issues/15901
- name: Get home directory of {{ cpmeta_username }}
  tags: cpmeta
  become_user: "{{ cpmeta_username }}"
  shell: "getent passwd {{ cpmeta_username }} | cut -d: -f6"
  register: cpmeta_home

- name: Create link to file storage
  tags: cpmeta
  become: yes
  become_user: "{{ cpmeta_username }}"
  file:
    dest: "{{ cpmeta_home.stdout }}/fileStorage"
    src: "{{ cpmeta_filestorage_target }}"
    state: link
  
