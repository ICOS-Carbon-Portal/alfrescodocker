user  www-data;
worker_processes  auto;
pid {{ dataold_pid_file }};

events {
    worker_connections  1024;
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    include /etc/nginx/mime.types;
    default_type  application/octet-stream;

    access_log syslog:server=unix:/dev/log,tag=dataold,nohostname,severity=info;
    error_log  syslog:server=unix:/dev/log,tag=dataold,nohostname,severity=error;

    gzip on;
    gzip_comp_level 6;

    gzip_types text/css text/plain text/csv text/tab-separated-values text/javascript application/javascript application/json application/octet-stream application/xml application/sparql-results+json application/x-font-woff image/svg+xml;

    gzip_proxied any;
    server {
        listen {{ dataold_ext_port }} ssl;
        server_name {{ certbot_domains | join(" ") }};
        client_max_body_size 8G;

        # Unsecure TLS configuration to support TLS1.0
        ssl_protocols TLSv1 TLSv1.1;
        ssl_ciphers "DHE-PSK-AES128-CBC-SHA256:DHE-PSK-AES256-CBC-SHA384:ECDHE-ECDSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA:ECDHE-PSK-AES128-CBC-SHA:ECDHE-PSK-AES128-CBC-SHA256:ECDHE-PSK-AES256-CBC-SHA:ECDHE-PSK-AES256-CBC-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:PSK-AES128-CBC-SHA256:PSK-AES256-CBC-SHA384:RSA-PSK-AES128-CBC-SHA256:RSA-PSK-AES256-CBC-SHA384:@SECLEVEL=1";

        ssl_certificate /etc/letsencrypt/live/{{ certbot_name }}/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/{{ certbot_name }}/privkey.pem;

        location /upload/etc/ {
                proxy_pass http://127.0.0.1:9011;
                proxy_set_header Host data.icos-cp.eu;
        }
    }
}
