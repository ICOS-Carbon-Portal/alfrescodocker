- include_tasks: "docker_{{ ansible_distribution | lower }}.yml"

- name: Install docker configuration
  copy:
    src: daemon.json
    dest: /etc/docker/
  notify: reload docker

- name: Start docker
  service:
    name: docker
    state: started
    enabled: yes

# We want all our docker projects to live below /docker. But since
# some of them use volumes that can grow quite large, we don't want
# them filling up the root filesystem. The solution is to first create
# a 'docker-compose-projects' elsewhere and then link it to /docker.
- name: Create {{ docker_compose_real_home }}
  file:
    path: "{{ docker_compose_real_home }}"
    state: directory
  register: _home

- name: Create link from {{ docker_compose_home }} to {{ docker_compose_real_home }}
  file:
    dest: "{{ docker_compose_home }}"
    src: "{{ _home.path }}"
    state: link

- name: Copy docker helper scripts
  copy:
    src: "{{ item }}"
    dest: "/usr/local/sbin/{{ item }}"
    mode: +x
  loop:
    - docker-unpack-image
    - docker-lineage
    - docker-list-ips
    - docker-entrypoint
    - docker-extract
    - docker-builds

- name: Copy Makefile for docker-compose projects
  template:
    src: Makefile
    dest: "{{ _home }}/"
