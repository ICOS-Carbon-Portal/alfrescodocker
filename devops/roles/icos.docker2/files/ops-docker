#!/usr/bin/env -S just --working-directory . --justfile

set positional-arguments
set shell := ['/bin/bash', '-cu']

@_default:
    just --list --unsorted --justfile {{justfile()}}


# list CMD and entrypoint of object
entrypoint object:
   @docker inspect --format \
   "{{ 'ENTRYPOINT:{{ range .Config.Entrypoint }} {{.}}{{ end }}
CMD:{{ range .Config.Cmd }} {{.}}{{ end }}'}}" "{{object}}"


# diff for ports between host and container
ports name:
    #!/usr/bin/bash
    set -Eueo pipefail
    pid=$(docker inspect -f {{ '{{.State.Pid}}' }} {{name}})
    inside=$(mktemp)
    outside=$(mktemp)
    trap 'rm -f $inside $outside' EXIT
    ss -tulpn > $outside
    nsenter -t $pid -n ss -tulpn > $inside
    diff $outside $inside || :
