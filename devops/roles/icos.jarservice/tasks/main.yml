- name: Add {{ username }} user
  user:
    name: "{{ username }}"

- name: Install {{servicename }} JAR and config
  copy: src={{ jarfile }} dest=/home/{{ username }}/  owner={{ username }} group={{ username }}
  register: installed_jarfile
  tags: deploy
  
- name: Create {{ servicename}} JAR symlink
  file:
    src: "{{ installed_jarfile.dest }}"
    dest: "/home/{{ username }}/{{ servicename }}.jar"
    state: link
  tags: deploy

- name: Add systemd {{ servicename }} servicefile
  template: src={{ servicetemplate }} dest=/etc/systemd/system/{{ servicename }}.service
  register: added_service
  tags: deploy
  
- block:
    - name: Reload systemd configuration
      command: systemctl daemon-reload

    - name: Restart {{ servicename }} service
      service: name={{ servicename }} state=restarted
  when: added_service.changed or installed_jarfile.changed
  tags: deploy

- name: Enable systemd {{ servicename }}
  service: name={{ servicename }} enabled=yes state=started
  tags: deploy

  
