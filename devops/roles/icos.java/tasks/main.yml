# Having this simple test speeds up execution of the playbook quite a bit.
- name: Check whether the java binary is present
  stat: path=/usr/bin/java
  register: java_bin_present

- block:
    # https://www.digitalocean.com/community/tutorials/how-to-install-java-on-centos-and-fedora
    - name: Retrieve Java as RPM
      get_url:
        headers='Cookie:oraclelicense=accept-securebackup-cookie'
        url={{java_rpm_url}}
        dest=/tmp/{{ java_rpm_url | basename }}
        mode=0644
    - name: Install Java using RPM
      package:
        name=/tmp/{{ java_rpm_url | basename }}
        state=present
  when: ansible_distribution == 'CentOS' and not java_bin_present.stat.exists

- block:
    # http://stackoverflow.com/a/19391042
    - name: Accept Oracles java license
      shell: >-
        echo debconf shared/accepted-oracle-license-v1-1 {{ item }} true \
        | debconf-set-selections
      with_items :
        - select
        - seen
    - name: Add PPA for Oracle installer
      apt_repository:
        repo='ppa:webupd8team/java'
    # www.webupd8.org/2017/06/why-oracle-java-7-and-6-installers-no.html
    - name: Install Oracles java installer
      package:
        name=oracle-java8-installer
        state=present
  when: ansible_distribution == 'Ubuntu' and not java_bin_present.stat.exists
