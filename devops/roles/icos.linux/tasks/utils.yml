- name: Copy utilities
  tags: linux_utils
  copy:
    src: "{{ item }}"
    dest: "/usr/local/sbin/{{ item }}"
    mode: 0755
  loop:
    - retrieve-original
    - remove-duplicate-port-forwards

- name: Install ss(1) wrapper
  copy:
    mode: 0755
    dest: /usr/local/sbin/ss
    content: |
      #!/bin/sh
      # ss(1) is frivolous with whitespace which makes output hard to read. This
      # script will compress the column-separating whitespace when printing to a
      # terminal.

      if [ -t 1 ]; then
          exec /bin/ss "$@" | column -t
      else
          exec /bin/ss "$@"
      fi
