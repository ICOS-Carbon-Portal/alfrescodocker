- name: Check that all parameters are defined
  fail:
    msg: "{{ item }} needs to be defined"
  when: vars[item] is undefined
  loop:
    - lxd_forward_ip
    - lxd_forward_name

- import_role: name=icos.port_forward
  vars:
    port_forward_dhost: "{{ lxd_forward_ip }}"
    port_forward_dport: "{{ lxd_forward_dport }}"
    port_forward_sport: "{{ lxd_forward_port }}"
    port_forward_desc: "{{ lxd_forward_desc }}"

- name: Modify /etc/hosts
  lineinfile:
    path: /etc/hosts
    regex: '(?:^{{ lxd_forward_ip | regex_escape}}.*)|(?:.*{{ lxd_forward_name }})\.lxd$'
    line: "{{ lxd_forward_ip }}\t{{ lxd_forward_name }}.lxd"
    state: present
