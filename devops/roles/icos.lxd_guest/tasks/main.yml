- name: Set timezone to Europe/Stockholm
  timezone:
    name: Europe/Stockholm
  notify: restart crond

- name: Install utilities
  apt:
    name:
      - mg       # microemacs
      - htop     # a better top(1)
      - jq       # like sed for json
      - make     # party like it's 1976
      - ncdu     # graphical disk usage
      - netcat-openbsd
      - git
      - tree
      - tcpdump
      # If the ssh ports aren't publicly exposed, we don't need fail2ban.
      - "{{ 'fail2ban' if lxd_guest_fail2ban else 'git' }}"
      - iptables-persistent
    update_cache: yes

- name: Install public keys
  authorized_key:
    user: root
    state: present
    key: "{{ lxd_guest_ssh_keys }}"
  when: lxd_guest_ssh_keys is truthy

- name: Add default gateway as host
  lineinfile:
    path: /etc/hosts
    line: "{{ ansible_default_ipv4.gateway }} gateway.lxd"
    regex: "gateway.lxd$"
    state: present
