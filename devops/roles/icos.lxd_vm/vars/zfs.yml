# DEVICES
__root_device:
  root:
    path: /
    type: disk
    # fsicos3 uses zfs and can utilize the default pool.
    pool: "default"
    size: "{{ lxd_vm_root_size }}"

__docker_device: >-
  {% if lxd_vm_docker -%}
  {"docker": {
    "path": "/var/lib/docker",
    "source": "{{ zfsdocker_zvol }}",
    "type": "disk",
    "raw.mount.options": "user_subvol_rm_allowed" }}
  {% else -%}{}{% endif -%}

lxd_default_devices: >-
  {{ __root_device | combine(__docker_device) }}


# PROFILES
lxd_default_profiles:
  - default
  - ssh_root


# CONFIG
__base_config:
  limits.cpu: "2"
  limits.memory: "4GB"

__docker_config: >-
  {% if lxd_vm_docker -%}
  {"security.nesting": "true"}
  {% else %}{}{% endif -%}

lxd_default_config: >-
  {{ __base_config | combine(__docker_config) }}
