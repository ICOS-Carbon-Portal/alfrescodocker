- name: Query for systemd-resolved
  systemd:
    name: systemd-resolved
  register: _resolved

- name: Setup DNS for systemd-resolved
  include_tasks:
    file: resolve-systemd.yml
  when: _resolved.status.ActiveState == "active"

- name: Setup DNS for dnsmasq
  include_tasks:
    file: resolve-dnsmasq.yml
  when: _resolved.status.ActiveState != "active"
