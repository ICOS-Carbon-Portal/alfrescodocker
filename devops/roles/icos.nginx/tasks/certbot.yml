---
- block:
    - name: Install Certbot for CentOS
      package: name=certbot-nginx state=present
  when: ansible_distribution == 'CentOS'

- block:
    - name: Install software-properties-common for Ubuntu
      package: name=software-properties-common state=present
    - name: Add PPA for Certbot for Ubuntu
      apt_repository: repo='ppa:certbot/certbot'
    - name: Install Certbot for Ubuntu
      package: name=python-certbot-nginx state=present
  when: ansible_distribution == 'Ubuntu'

- name: Add job to renew certificates
  cron:
    name: Certbot renewal
    job: "certbot renew --post-hook 'service nginx reload'"
    special_time: weekly
