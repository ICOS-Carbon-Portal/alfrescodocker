- name: Install software-properties-common for Ubuntu
  apt:
    name: software-properties-common

- name: Add Certbot PPA
  apt_repository:
    repo: ppa:certbot/certbot

- name: Install Certbot for nginx
  package:
    name: python-certbot-nginx

- name: Add job to renew certificates
  cron:
    name: Certbot renewal
    job: "{{ nginx_certbot_bin }} renew -q"
    special_time: daily

- name: Add a nginx deploy-hook for certbot
  copy:
    dest: /etc/letsencrypt/renewal-hooks/deploy/nginx.sh
    mode: +x
    content: |
      #!/bin/bash
      service nginx reload
