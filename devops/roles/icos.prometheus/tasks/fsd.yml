- name: Check that the metrics endpoint responds
  delegate_to: "{{ fsd_prom_host }}"
  uri:
    url: "https://{{ fsd_host }}{{ fsd_url }}"
  retries: 10

- name: Install prometheus config
  delegate_to: "{{ fsd_prom_host }}"
  copy:
    dest: "{{ fsd_prom_path }}/{{ fsd_name }}.yml"
    content: |
      - targets:
          - {{ fsd_host }}
        labels:
          __metrics_path__: "{{ fsd_url }}"
          app: {{ fsd_app }}
          server: {{ fsd_server }}
