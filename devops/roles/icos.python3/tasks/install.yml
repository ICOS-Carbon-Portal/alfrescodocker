- name: Add ppa:deadsnakes repository
  apt_repository:
    repo: ppa:deadsnakes/ppa

- name: Install python {{ python3_version }}
  apt:
    update_cache: yes
    name:
      - "python{{ python3_version }}-venv"

- name: Create our own pip3 command
  copy:
    dest: "{{ python3_pip }}"
    mode: +x
    # By default, ppa:deadsnakes doesn't ship with its own pip3.X. But should
    # it exst, don't overwrite it.
    force: no
    content: |
      #!{{ python3_command }}
      # -*- coding: utf-8 -*-
      import re
      import sys
      from pip._internal.cli.main import main
      if __name__ == '__main__':
          sys.argv[0] = re.sub(r'(-script\.pyw|\.exe)?$', '', sys.argv[0])
          sys.exit(main())
