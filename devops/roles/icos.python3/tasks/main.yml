# First install pip and venv for the system version of python. This is for the
# sake of later ansible modules.
- name: Install pip and venv
  apt:
    # This role is included by lxd_guest, and as such is often the first
    update_cache: true
    name:
      - python3-pip
      - python3-virtualenv
      # On some targets, this is required for the ansible 'pip' module.
      - virtualenv

# Install pipx using ansible's python. This will allow us to use the ansible
# pipx module to install utils written in python.
- name: Install pipx
  pip:
    name: pipx

- name: Create "global" version of pipx
  copy:
    dest: /usr/local/sbin/pipx-global
    mode: +x
    content: |
      #!/usr/bin/bash
      PIPX_HOME=/opt/pipx PIPX_BIN_DIR=/usr/local/bin pipx "$@"

- name: Installing several versions of python3
  include_tasks: install.yml
  when: python3_version_list is defined
  loop: "{{ python3_version_list }}"
  loop_control:
    loop_var: python3_install_version

- name: Installing a single version of python3
  include_tasks: install.yml
  when:
    - python3_version_list is not defined
    - python3_version is defined
