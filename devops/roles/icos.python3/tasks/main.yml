# Install python 3.5 (or higher as might be the case with Ubuntu).  The
# requirement comes from one of our python scripts that uses os.scandir()
# (introduced in 3.5)

- block:
    - name: Install python packages
      apt:
        name: "{{ item }}"
        state: present
      loop:
        - python3
        - python3-pip
        - python3-venv
  when:
    - ansible_distribution == 'Ubuntu'
  become: true

- block:
    # The EPEL-release only has 3.4 - use the IUS repo instead.
    - name: Add the IUS repo
      yum: name=https://centos7.iuscommunity.org/ius-release.rpm state=present

    - name: Install python3
      yum: name=python36u state=present

    - name: Create symbolic link for python3
      file: dest=/usr/bin/python3 src=/bin/python3.6 state=link
  when:
    - ansible_distribution == 'CentOS'
  become: true

- name: Check that python3 version is >= 3.6
  shell: "python3 --version 2>&1 | grep -q '^Python 3.[6789]'"
  changed_when: false
