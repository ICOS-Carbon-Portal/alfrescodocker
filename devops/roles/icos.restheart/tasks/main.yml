- name: Add restheart user
  user:
    name: restheart
    groups: docker
    append: yes
    shell: /bin/bash

- name: Make sure git is installed
  package: name=git state=present

- name: Clone infrastructure
  become: True
  become_user: restheart
  git:
    repo: https://github.com/ICOS-Carbon-Portal/infrastructure.git
    version: master
    dest: /home/restheart/infrastructure

- name: Launch MongoDB
  docker_container:
    name: mongodb
    image: mongo:3.2
    volumes:
      - /home/restheart/infrastructure/restheart/storage:/data/db

- name: Launch RestHeart
  docker_container:
    name: restheart
    image: softinstigate/restheart:2.0.2
    links:
      - mongodb
    ports:
      - "127.0.0.1:8088:8080"
    volumes:
      - /home/restheart/infrastructure/restheart/security.yml:/opt/restheart/etc/security.yml:ro
