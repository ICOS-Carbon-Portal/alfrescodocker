---
- name: Check if SSL certificate exists
  stat:
    path: "/etc/letsencryt/renewal/data.fieldsites.se.conf"
  register: cert_installed

- name: Install certificate
  command: >
    {{ certbot_command }} certonly
    --authenticator webroot
    --installer nginx
    --non-interactive
    --webroot-path /usr/share/nginx/html/
    --domain data.fieldsites.se
    --domain admin.fieldsites.se
    --email {{ vault_sites_stations_SSL_email }}
    --agree-tos
  when: not cert_installed.stat.exists
  notify: reload nginx config
