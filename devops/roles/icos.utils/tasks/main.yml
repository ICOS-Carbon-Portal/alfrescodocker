- name: Create common aliases
  tags: alias
  copy:
    dest: /etc/profile.d/aliases.sh
    content: |
      alias sc=systemctl
      alias jc=journalctl
      alias df='df -h -x tmpfs -x overlay -x devtmpfs'
      alias dc=docker-compose
      alias psc='ps xawf -eo pid,user,cgroup,args'

- name: Change default pager
  copy:
    dest: /etc/profile.d/use_most_pager.sh
    content: |
      export PAGER=most


- name: Copy utilities
  tags: utils_copy
  template:
    src: "{{ item }}"
    dest: "/usr/local/sbin/{{ item }}"
    mode: 0755
  loop:
    - retrieve-original
    - iptables-remove-duplicates
    - ss
    - ssh-merge-config

- name: Install utilities
  apt:
    update_cache: yes
    name:
      - mg             # microemacs
      - htop           # a better top(1)
      - jq             # like sed for json
      - make           # party like it's 1976
      - ncdu           # graphical disk usage
      - netcat-openbsd # nc(1)
      - git            # useful
      - tree           # directory overview
      - tcpdump        # network troubleshooting
      - mailutils      # so cron can deliver failure reports
      - mutt           # for reading said reports
      - unzip          # required by ansible's unarchive
      - ripgrep        # fast searching
      - most           # colorized man pages


# FD
- name: Install fd
  tags: fd
  apt:
    deb: "{{ utils_fd_url }}"

- name: Test fd
  tags: fd
  command: fd --version
  changed_when: false


# BROOT
- name: Download broot binary
  tags: broot
  get_url:
    url: https://dystroy.org/broot/download/x86_64-unknown-linux-musl/broot
    dest: /usr/local/bin/broot
    mode: +x
  register: _broot

- name: Install broot shell helper
  tags: broot
  command: "{{ _broot.dest }} --install"
  changed_when: false


# JC
- name: Install jc
  tags: jc
  include_role:
    name: icos.github_download_bin
    apply: {tags: jc}
  vars:
    dbin_user: kellyjonbrazil
    dbin_repo: jc
    dbin_src: jc
    dbin_url: "{{ dbin__down }}/v{{ dbin__vers }}/jc-{{ dbin__vers }}-linux-{{ ansible_machine }}.tar.gz"

- name: Test jc
  command: "{{ dbin_symlink.dest }} --version"
  changed_when: false


# WATCHEXEC
- name: Install watchexec
  tags: watchexec
  include_role:
    name: icos.github_download_bin
    apply: {tags: watchexec}
  vars:
    dbin_user: watchexec
    dbin_repo: watchexec
    # https://github.com/watchexec/watchexec/releases/download/v1.20.6/watchexec-1.20.6-x86_64-unknown-linux-musl.tar.xz
    dbin_url: "{{ dbin__down }}/v{{ dbin__vers }}/watchexec-{{ dbin__vers.lstrip('v') }}-{{ watchexec_arch }}-unknown-linux-musl.tar.xz"

- name: Test watchexec
  tags: watchexec
  command: "{{ dbin_symlink.dest }} --version"
  changed_when: false
