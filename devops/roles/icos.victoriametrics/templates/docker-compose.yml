# https://github.com/VictoriaMetrics/VictoriaMetrics/blob/master/deployment/docker/docker-compose.yml

version: "3.5"
services:
  victoriametrics:
    hostname: victoriametrics
    container_name: victoriametrics
    image: victoriametrics/victoria-metrics
    ports:
      - 127.0.0.1:{{ vm_vm_port }}:{{ vm_vm_port }}
    volumes:
      - ./prometheus:/etc/prometheus
      - vmdata:/storage
    command:
      - "-promscrape.config=/etc/prometheus/prometheus.yml"
      - "-storageDataPath=/storage"
      - "-httpListenAddr=:{{ vm_vm_port }}"
      - "-selfScrapeInterval=10s"
    networks:
      - vm_net
    restart: always

  grafana:
    hostname: grafana
    container_name: grafana
    image: grafana/grafana
    depends_on:
      - "victoriametrics"
    ports:
      - 127.0.0.1:{{ vm_graf_port }}:{{ vm_graf_port }}
    environment:
      GF_SECURITY_ADMIN_USER: "admin"
      GF_SECURITY_ADMIN_PASSWORD: "{{ vm_graf_pass }}"
    volumes:
      - grafanadata:/var/lib/grafana
      - ./grafana/provisioning/:/etc/grafana/provisioning/
      - ./grafana/grafana.ini:/etc/grafana/grafana.ini
    networks:
      - vm_net
    restart: always

volumes:
  vmdata: {}
  grafanadata: {}

networks:
  vm_net:
