all:
  vars:
    cpmeta_icos_domain: metastaging.icos-cp.eu
    # the domains are needed both for the host (to find the buildInfo url) and
    # for the server (to set up proxy)
    cpmeta_domains:
      - "{{ cpmeta_icos_domain }}"
      - metastaging.fieldsites.se

    cpdata_domains:
      - datastaging.icos-cp.eu
      - datastaging.fieldsites.se

    cpauth_domains:
      - cpauthstaging.icos-cp.eu
      - authstaging.fieldsites.se

    doi_domains:
      - doistaging.icos-cp.eu

  children:
    core_host:
      hosts:
        staging:

      vars:
        coreapp_bind_addr: 0.0.0.0

        # cpmeta - application
        cpmeta_filestorage_target: "{{ cpmeta_home }}/filestorage"
        cpmeta_backup_enable: false
        cpmeta_config_files:
          - application_production.conf
          - application_production_sensitive.conf
          - application_staging_amendment.conf

        # cpdata - application
        # when running in an lxd VM, bind all interfaces so that we're reachable
        # from the host.
        cpdata_filestorage_target: "/data/dataAppStorage"
        cpdata_config_files:
          - application_production.conf
          - application_staging_amendment.conf

        # cpauth - application
        cpauth_config_files:
          - application_production.conf
          - application_staging_amendment.conf


    core_server:
      hosts:
        fsicos2.lunarc.lu.se:
          ansible_port: 60022

      vars:
        coreapp_httpproxy_host: staging.lxd
        coreapp_host_ip: "{{ staging_lxd_ip }}"

        # cpmeta - proxy
        cpmeta_nginxsite_name: cpmeta-staging
        cpmeta_certbot_name: cpmeta-staging

        # cpdata - proxy
        cpdata_certbot_name: cpdata-staging
        cpdata_nginxsite_name: cpdata-staging

        # cpauth - proxy
        cpauth_certbot_name: cpauth-staging
        cpauth_nginxsite_name: cpauth-staging

        # restheart - proxy
        restheart_host: staging.lxd
        restheart_nginxsite_name: restheart-staging
        restheart_certbot_name: restheart-staging
        restheart_domains:
          - restheartstaging.icos-cp.eu

        # doi - proxy
        doi_certbot_name: doi-staging
        doi_nginxsite_name: doi-staging
