- name: Change timezone to Europe/Stockholm
  # <2017-01-09 mån> My version of ansible doesn't have the 'timezone' module so
  # I'll just to the linking myself.
  file:
    dest: /etc/localtime
    src: /usr/share/zoneinfo/Europe/Stockholm
    state: link

- name: Add ssh key to root
  authorized_key:
    user: root
    state: present
    key: "{{ lookup('file', lookup('env','HOME') + '/.ssh/id_rsa.pub') }}"
    
- name: Set hostname
  hostname: name=vagrant
                                                                                      
- name: Add the EPEL repo                                                               
  yum: name=epel-release state=present                                                  
                                                                                        
- name: Add the official docker repository
  yum_repository:
    name: docker
    description: Offical Docker RPM repository
    enabled: yes
    baseurl: https://yum.dockerproject.org/repo/main/centos/7/
    gpgcheck: yes
    gpgkey: https://yum.dockerproject.org/gpg

- name: Add the official scala rpm repository
  yum_repository:
    name: bintray-sbt
    description: Official Scala RPM repository
    baseurl: https://dl.bintray.com/sbt/rpm
    gpgcheck: no
    repo_gpgcheck: no
    
- name: Install system packages
  yum: name={{ item }} state=present
  with_items:
    - git
    - python-pip
    # <2017-01-16 mån> Installing 'docker-engine' instead of the default
    # 'docker'. The reason is that 'docker' didn't work properly out of the box
    # - the client couldn't reach the daemon due to (I think) a socket mishap.
    - docker-engine
    - sbt
    - nginx
  
- name: Start docker
  service: name=docker state=started enabled=yes

# Required to be present for ansible's docker module to work properly.
- name: Install docker-py
  pip:
    name=docker-py
